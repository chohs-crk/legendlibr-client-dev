기존 구조를 바탕으로 자세한 구조를 설명할게

1. 레이드 준비
일단 보스를 선택한다. 보스 정보는 db에 저장되어 있고, 서버 한번 호출해서 받아온다
프론트에는 이름, 설명, 스킬(스킬 이름, 스킬 설명)정도 보내고, 나머진 서버 세션에 저장한다
보스를 선택하면 캐릭터 선택 화면으로 넘어간다
지금 ui에 노출되는 부분은 캐릭터 이름, 스킬 이름 정도다
여기서 나중에 추가로 쓸 부분인 스킬 설명(longdesc)까지만 넘긴다

2. 매칭
캐릭터 다 정하고 배틀 돌리면
여기가 좀 중요한데
aiready battlestart battlefinished로 분기 구별한다
매칭을 돌리면 raid 문서를 새로 생성한다
그다음에 비동기 ai 호출을 한다
ai 호출이 완료하고 db 갱신하면 aiready 활성화된다
하지만 유저가 다른 작업을 하다 오는 것 자체는 괜찮아야 하므로
시작할지 포기했던 걸로 간주할지는 battlestart로 판단한다
battlestart가 false면 controller 실행하고 true로 변경
true면 이전에 배틀을 하다(배틀 전이 아니고) 종료한 경험이 있는 것이므로
포기로 간주(battlefinished true로 변경)
모두 false면 로딩
aiready만 true면 시작 가능
battlestart까지 true면 패배 처리로 하기
모두 true면 정상적으로 끝난 파일

3. 배틀
기존 로직 그대로 유지, 서버세션저장 잘 사용하기

추가적인 수정 사항
배틀 준비를 할 때 고르지 않은 스킬은 지금 아예 ai 호출에 쓰지 않는데
내 캐릭터가 모두 같고 보스가 같으면 호출 스킵을 추가하기 위해서
db에 저장하는 스킬 자체는 4개 모두 하기
단 배틀 시작하면 유저가 정한 3개 스킬 중 선택하기