<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>캐릭터 목록</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- 공통 스타일 -->
    <link rel="stylesheet" href="/stylesheet/base/common.css">
    <link rel="stylesheet" href="/stylesheet/base/chrome.css">
    <link rel="stylesheet" href="/stylesheet/base/index.css">
    <link rel="stylesheet" href="/stylesheet/base/confirm.css">
</head>

<body>
    <!-- ===============================
         BACKGROUND
    =============================== -->
    <div class="bg-root">
        <div class="bg-frame"></div>

        <!-- ===============================
             APP (스크롤 콘텐츠 전용)
        =============================== -->
        <div class="app">
            <div id="chrome-root"></div>




            <!-- ===============================
                 MAIN CONTENT
            =============================== -->
            <main class="content">
                <div class="bar"></div>
                <!-- 🔽 스크롤 가능한 영역 -->
                <div class="scroll-area">
                    <div id="charList" class="list"></div>
                </div>

            </main>

            <div class="footer-stack">
                <div class="create-wrap">
                    <button id="btnCreate" class="btn-create">생성하기</button>
                </div>
            </div>
        </div> <!-- /.app -->
    </div> <!-- /.bg-root -->
    <!-- CONFIRM UI -->
    <div id="confirmOverlay" class="ui-confirm-overlay">
        <div class="ui-confirm">
            <div id="confirmText"></div>
            <div class="ui-confirm-actions" id="confirmActions"></div>
        </div>
    </div>


    <!-- ===============================
         DETAIL DIALOG
    =============================== -->
    <dialog id="detailDialog">
        <div class="dlg">
            <h2 id="detailTitle">캐릭터 상세</h2>

            <div class="field">
                <label>이름</label>
                <div id="detailName" class="box"></div>
            </div>

            <div class="field" id="aiStoryBlock" style="display:none;">
                <label>스토리</label>
                <div id="detailAiStory" class="box" style="white-space:pre-wrap;"></div>
            </div>

            <div class="field" id="aiSkillsBlock" style="display:none;">
                <label>AI 스킬</label>
                <ul id="detailSkills" class="box"></ul>
            </div>

            <div class="row">
                <button class="btn" id="closeDetail">닫기</button>
                <button class="btn" id="deleteChar">삭제</button>
            </div>
        </div>
    </dialog>

    <script>
        window.API = {
            BASE: "https://ai-proxy2.vercel.app/api/base",

            async getMyCharacters() {
                const res = await fetch(`${this.BASE}/characters`, {
                    credentials: "include"
                });
                if (!res.ok) throw new Error("인증 실패");
                return await res.json();
            },

            async deleteCharacter(id) {
                const res = await fetch(`${this.BASE}/characters?id=${id}`, {
                    method: "DELETE",
                    credentials: "include"
                });
                if (!res.ok) throw new Error("삭제 실패");
                return await res.json();
            }
        };

        window.API.me = async function () {
            const res = await fetch(`${this.BASE}/auth?action=me`, {
                credentials: "include"
            });

            if (res.status === 401) return null;
            if (!res.ok) throw new Error("서버 오류");

            return await res.json();
        };
    </script>

    <script type="module" src="/base/Script1.js"></script>

    <script type="module">
        fetch("/base/common/chrome.html")
            .then(r => r.text())
            .then(html => {
                document.getElementById("chrome-root").innerHTML = html;
                return import("/base/common/chrome.js");
            })
            .then(m => {
                m.initChrome({ mode: "resource-only" });
            });
    </script>
    <script type="module">
        import { initOverscrollBounce } from "/base/common/overscroll-bounce.js";
        initOverscrollBounce();  // 기본: .scroll-area
    </script>



</body>
</html>
